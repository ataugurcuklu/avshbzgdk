---
import AdminLayout from "@layouts/AdminLayout.astro";
import EditPostForm from "@components/admin/Post/EditPostForm";
import { getPostBySlug, getPostContent } from "../../../utils/blog";

const { slug } = Astro.params;

const authCookie = Astro.cookies.get("auth");
if (!authCookie || authCookie.value !== import.meta.env.SECRET_KEY) {
  return Astro.redirect("/admin");
}

if (!slug) {
  return Astro.redirect("/admin/posts");
}

const post = await getPostBySlug(slug);
if (!post) {
  return Astro.redirect("/admin/posts");
}

const content = await getPostContent(slug);

const postData = {
  fileName: post.id,
  title: post.data.title,
  description: post.data.description,
  content: content,
  heroImage: post.data.heroImage,
  altText: post.data.altText,
};
---

<AdminLayout title="Edit Post">
  <EditPostForm postData={postData} client:load />
</AdminLayout>
